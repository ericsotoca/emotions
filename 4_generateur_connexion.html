<!DOCTYPE html>
<html lang="fr" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Connexion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .mission-card { min-height: 200px; display: flex; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>
    <div class="container my-5" style="max-width: 600px;">
        <a href="index.html" class="btn btn-outline-secondary btn-sm mb-4">‚Üê Retour au portail</a>
        <div class="text-center">
            <h1>G√©n√©rateur de Connexion</h1>
            <p class="lead text-white-50">Un petit pas chaque jour pour construire des ponts.</p>
        </div>

        <div class="card my-4 text-center">
            <div class="card-header">
                Mission du Jour
            </div>
            <div class="card-body mission-card">
                <h4 class="card-title" id="mission-text">Cliquez sur "Nouvelle Mission" pour commencer.</h4>
            </div>
            <div class="card-footer d-flex justify-content-between align-items-center">
                <button class="btn btn-success" id="done-btn">Mission Accomplie !</button>
                <button class="btn btn-secondary" id="new-mission-btn">Autre Mission</button>
            </div>
        </div>
        
        <div class="text-center">
            <h5>Total des missions accomplies : <span class="badge bg-info" id="score-counter">0</span></h5>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const missions = [
        "Envoyez un message √† un proche juste pour lui dire que vous pensez √† lui, sans rien attendre en retour.",
        "Lors d'une conversation, posez une question ouverte sur les ressentis de votre interlocuteur (ex: 'Comment te sens-tu par rapport √† √ßa ?').",
        "Partagez une petite vuln√©rabilit√© ou incertitude avec une personne de confiance (ex: 'Je ne suis pas s√ªr de comment aborder ce projet').",
        "Remerciez sinc√®rement quelqu'un pour quelque chose de sp√©cifique qu'il a fait pour vous.",
        "Proposez votre aide √† quelqu'un, m√™me pour une petite t√¢che.",
        "Partagez une anecdote personnelle positive de votre journ√©e avec un proche.",
        "Prenez 5 minutes pour √©couter quelqu'un sans l'interrompre et sans chercher de solution.",
        "Faites un compliment sinc√®re et pr√©cis √† un coll√®gue ou un ami.",
        "Planifiez une activit√© (m√™me petite, comme un caf√©) avec un ami que vous n'avez pas vu depuis longtemps."
    ];

    const missionTextEl = document.getElementById('mission-text');
    const newMissionBtn = document.getElementById('new-mission-btn');
    const doneBtn = document.getElementById('done-btn');
    const scoreCounterEl = document.getElementById('score-counter');

    let score = parseInt(localStorage.getItem('connectionScore') || '0');
    scoreCounterEl.textContent = score;

    // Fonction d'aide : Algorithme de m√©lange Fisher-Yates
    function shuffleArray(array) {
        const shuffled = [...array]; 
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]; // Swap
        }
        return shuffled;
    }

    function getNewMission() {
        // 1. R√©cup√©rer le "paquet" m√©lang√© sauvegard√©
        let shuffledMissions = JSON.parse(localStorage.getItem('shuffledMissionsDeck') || '[]');

        // 2. Si le paquet est vide, on rem√©lange
        if (shuffledMissions.length === 0) {
            shuffledMissions = shuffleArray(missions);
        }

        // 3. Tirer la prochaine carte (la prochaine mission)
        const mission = shuffledMissions.pop();

        // 4. Sauvegarder le reste du paquet
        localStorage.setItem('shuffledMissionsDeck', JSON.stringify(shuffledMissions));

        // 5. Afficher et sauvegarder la mission actuelle
        missionTextEl.textContent = mission;
        localStorage.setItem('currentMission', mission);
    }
    
    // Le bouton "Nouvelle Mission" force maintenant le tirage d'une nouvelle carte du paquet
    newMissionBtn.addEventListener('click', getNewMission);

    doneBtn.addEventListener('click', () => {
        // Ne rien faire si la mission n'est pas valide ou d√©j√† c√©l√©br√©e
        if (missionTextEl.textContent.startsWith('Cliquez') || missionTextEl.textContent.startsWith('üéâ')) return;
        
        score++;
        localStorage.setItem('connectionScore', score);
        scoreCounterEl.textContent = score;
        missionTextEl.innerHTML = `üéâ Bravo ! Pr√™t pour la suivante ?`;
        
        // On tire la mission suivante du paquet apr√®s un court d√©lai
        setTimeout(getNewMission, 2000);
    });

    // Au chargement initial :
    // On v√©rifie si une mission √©tait d√©j√† en cours (sauvegard√©e par getNewMission)
    const savedMission = localStorage.getItem('currentMission');
    if (savedMission) {
        missionTextEl.textContent = savedMission;
    } else {
        // Si aucune mission n'√©tait en cours, on en tire une nouvelle du paquet
        getNewMission();
    }
});
</script>
</body>
</html>
