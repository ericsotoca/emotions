<!DOCTYPE html>
<html lang="fr" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compas des Valeurs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .range-value {
            font-weight: bold;
            min-width: 25px;
            display: inline-block;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <a href="index.html" class="btn btn-outline-secondary btn-sm mb-4">← Retour au portail</a>
        <div class="text-center">
            <h1>Le Compas des Valeurs</h1>
            <p class="lead text-white-50">Prenez des décisions alignées avec ce qui compte le plus pour vous.</p>
        </div>

        <!-- Section 1: Définition des valeurs -->
        <div class="card my-4">
            <div class="card-body">
                <h5 class="card-title">Étape 1 : Mes Valeurs Fondamentales</h5>
                <p class="card-text text-white-50 small">Ce sont les piliers de votre boussole intérieure. Ajoutez ou supprimez des valeurs pour qu'elles vous correspondent parfaitement.</p>
                <div id="values-container"></div>
                <div class="input-group mt-3">
                    <input type="text" id="new-value-input" class="form-control" placeholder="Ajouter une nouvelle valeur (ex: Créativité)">
                    <button class="btn btn-outline-secondary" id="add-value-btn">Ajouter</button>
                </div>
            </div>
        </div>

        <!-- Section 2: Outil de décision -->
        <div class="card my-4">
            <div class="card-body">
                <h5 class="card-title">Étape 2 : Évaluer une Décision</h5>
                
                <div class="alert alert-info small">
                    <strong>Comment ça marche ?</strong><br>
                    Pour chaque option que vous envisagez, évaluez sur une échelle de 0 à 10 à quel point elle nourrit chacune de vos valeurs.
                    (0 = Pas du tout aligné, 10 = Parfaitement aligné).
                </div>
                
                <div class="mb-3">
                    <label for="decision-name" class="form-label">Quelle décision souhaitez-vous évaluer ?</label>
                    <input type="text" id="decision-name" class="form-control" placeholder="Ex: Changer de projet professionnel">
                </div>
                <div id="options-container">
                    <!-- Les options de décision seront ajoutées ici -->
                </div>
                <button class="btn btn-secondary mt-2" id="add-option-btn">+ Ajouter une option</button>
                <hr>
                <button class="btn btn-primary w-100" id="calculate-btn">Calculer l'Alignement</button>
            </div>
        </div>
        
        <!-- Section 3: Résultats -->
        <div id="results-container" class="mt-5"></div>

    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const valuesContainer = document.getElementById('values-container');
    const newValueInput = document.getElementById('new-value-input');
    const addValueBtn = document.getElementById('add-value-btn');
    const optionsContainer = document.getElementById('options-container');
    const addOptionBtn = document.getElementById('add-option-btn');
    const calculateBtn = document.getElementById('calculate-btn');
    const resultsContainer = document.getElementById('results-container');

    let values = JSON.parse(localStorage.getItem('userValues')) || ['Sécurité & Stabilité', 'Aventure & Liberté', 'Connaissance & Croissance', 'Créativité & Expression', 'Relations & Connexion'];
    let optionCount = 0;

    const renderValues = () => {
        valuesContainer.innerHTML = values.map(value => `
            <span class="badge bg-primary fs-6 me-2 mb-2 p-2">${value} 
                <button class="btn-close btn-close-white ms-1" style="font-size: 0.7em;" data-value="${value}"></button>
            </span>
        `).join('');
    };

    addValueBtn.addEventListener('click', () => {
        const newValue = newValueInput.value.trim();
        if (newValue && !values.includes(newValue)) {
            values.push(newValue);
            localStorage.setItem('userValues', JSON.stringify(values));
            newValueInput.value = '';
            renderValues();
        }
    });
    
    valuesContainer.addEventListener('click', (e) => {
        if (e.target.matches('.btn-close')) {
            const valueToRemove = e.target.dataset.value;
            values = values.filter(v => v !== valueToRemove);
            localStorage.setItem('userValues', JSON.stringify(values));
            renderValues();
        }
    });
    
    // Écouteur pour mettre à jour la valeur du curseur en temps réel
    optionsContainer.addEventListener('input', (e) => {
        if (e.target.type === 'range') {
            const display = e.target.nextElementSibling;
            if (display && display.classList.contains('range-value')) {
                display.textContent = e.target.value;
            }
        }
    });

    addOptionBtn.addEventListener('click', () => {
        optionCount++;
        const optionDiv = document.createElement('div');
        optionDiv.className = 'card bg-dark my-3 p-3 option-card';
        optionDiv.id = `option-${optionCount}`;
        optionDiv.innerHTML = `
            <h6>Option ${optionCount}</h6>
            <input type="text" class="form-control form-control-sm mb-3" placeholder="Description de l'option (ex: Accepter la nouvelle offre)">
            ${values.map(value => `
                <div class="mb-2">
                    <label for="option-${optionCount}-${value}" class="form-label small">${value}</label>
                    <div class="d-flex align-items-center">
                        <input type="range" class="form-range" min="0" max="10" step="1" value="5" id="option-${optionCount}-${value}" data-value="${value}">
                        <span class="range-value ms-2 badge bg-secondary">5</span>
                    </div>
                </div>
            `).join('')}
        `;
        optionsContainer.appendChild(optionDiv);
    });
    
    calculateBtn.addEventListener('click', () => {
        const options = document.querySelectorAll('.option-card');
        if (options.length === 0) return;
        
        let results = [];
        const maxScore = values.length * 10;

        options.forEach(option => {
            const name = option.querySelector('input[type="text"]').value || `Option ${option.id.split('-')[1]}`;
            let score = 0;
            let breakdown = {};
            option.querySelectorAll('input[type="range"]').forEach(slider => {
                const valueName = slider.dataset.value;
                const valueScore = parseInt(slider.value, 10);
                score += valueScore;
                breakdown[valueName] = valueScore;
            });
            results.push({ name, score, breakdown });
        });
        
        results.sort((a, b) => b.score - a.score);
        
        resultsContainer.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Résultats pour : "${document.getElementById('decision-name').value || 'votre décision'}"</h5>
                </div>
                <ul class="list-group list-group-flush">
                    ${results.map((r, index) => {
                        const alignmentPercent = maxScore > 0 ? (r.score / maxScore * 100).toFixed(0) : 0;
                        return `
                        <li class="list-group-item ${index === 0 ? 'list-group-item-success' : ''}">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${r.name}</h6>
                                ${index === 0 ? '<span class="badge bg-success">Meilleur alignement</span>' : ''}
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <strong class="me-2">Alignement: ${alignmentPercent}%</strong>
                                <div class="progress flex-grow-1" style="height: 20px;">
                                    <div class="progress-bar" role="progressbar" style="width: ${alignmentPercent}%;" aria-valuenow="${alignmentPercent}">${r.score} / ${maxScore} pts</div>
                                </div>
                            </div>
                            <p class="mb-1 small">
                                <a data-bs-toggle="collapse" href="#details-${index}" role="button">
                                    Voir le détail des points ▼
                                </a>
                            </p>
                            <div class="collapse" id="details-${index}">
                                <ul class="list-unstyled small mt-2">
                                    ${Object.entries(r.breakdown).sort((a,b) => b[1] - a[1]).map(([key, val]) => `
                                        <li><strong>${key}:</strong> ${val} / 10</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </li>
                        `;
                    }).join('')}
                </ul>
            </div>
        `;
    });
    
    renderValues();
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
